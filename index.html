<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Markdown to HTML Converter | Bootstrap + Marked + Highlight.js</title>
  <meta name="description" content="Converts a provided markdown data URI to HTML using marked.js and applies syntax highlighting using highlight.js. Built with Bootstrap 5." />

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Highlight.js theme (GitHub style) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" />

  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --card-bg: #ffffff;
      --text: #111827; /* gray-900 */
      --muted: #6b7280; /* gray-500 */
      --primary: #0d6efd; /* Bootstrap primary */
    }
    html, body { height: 100%; }
    body {
      background: linear-gradient(180deg, #0f172a 0%, #111827 100%);
      color: var(--text);
    }
    .app-header {
      background: rgba(255,255,255,0.08);
      border-bottom: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(6px);
    }
    .brand-title { color: #fff; }
    .brand-subtitle { color: rgba(255,255,255,0.75); }
    .card.app-card {
      border: 1px solid rgba(17, 24, 39, 0.08);
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }
    #markdown-output {
      font-size: 1rem;
      line-height: 1.7;
    }
    #markdown-output h1, #markdown-output h2, #markdown-output h3,
    #markdown-output h4, #markdown-output h5, #markdown-output h6 {
      margin-top: 1.25rem;
      margin-bottom: 0.75rem;
      font-weight: 700;
    }
    #markdown-output p { margin-bottom: 1rem; }
    #markdown-output ul, #markdown-output ol { margin-bottom: 1rem; }
    #markdown-output code {
      background-color: rgba(2, 6, 23, 0.06);
      padding: 0.2rem 0.3rem;
      border-radius: 0.25rem;
    }
    #markdown-output pre {
      background-color: #f8fafc;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(17,24,39,0.08);
      overflow: auto;
    }
    footer small { color: rgba(255,255,255,0.8); }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header py-4 mb-4">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h1 class="brand-title h3 mb-1">Markdown to HTML Converter</h1>
          <p class="brand-subtitle mb-0">Rendered with marked.js and highlighted with highlight.js (Bootstrap 5 UI)</p>
        </div>
        <div>
          <a class="btn btn-outline-light btn-sm" href="#markdown-output" role="button">Jump to Output</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <div id="app-alert" class="mb-3" aria-live="polite" aria-atomic="true"></div>

    <div class="card app-card">
      <div class="card-header d-flex align-items-center justify-content-between">
        <span class="fw-semibold">Rendered Markdown</span>
        <div class="d-flex gap-2">
          <button id="btn-render" type="button" class="btn btn-primary btn-sm">Re-render</button>
          <button id="btn-copy-html" type="button" class="btn btn-outline-secondary btn-sm">Copy HTML</button>
        </div>
      </div>
      <div class="card-body">
        <div id="markdown-output" class="prose"></div>
      </div>
    </div>

    <div class="card app-card mt-4">
      <div class="card-header">Source: Embedded data URI</div>
      <div class="card-body">
        <p class="text-muted mb-2">This app decodes a markdown data URI and renders it with marked.js, then applies syntax highlighting using highlight.js.</p>
        <pre class="mb-0"><code id="data-uri-display" class="language-text"></code></pre>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-5 py-4">
    <div class="container text-center">
      <small>Static client-side application. Works on GitHub Pages.</small>
    </div>
  </footer>

  <!-- Libraries via CDN -->
  <!-- marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- highlight.js (common languages, includes Python) -->
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
  <!-- Optional: DOMPurify for safe HTML rendering -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.2/dist/purify.min.js"></script>
  <!-- Bootstrap JS (optional, for buttons if needed) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Application Script (inline, no external files) -->
  <script>
    (function () {
      'use strict';

      // Store data URIs as constants in JavaScript (exactly as provided)
      const INPUT_MD_DATA_URI = 'data:text/markdown;base64,IyBXZWxjb21lIHRvIE15IEFwcAoKVGhpcyBpcyBhICoqdGVzdCoqIG1hcmtkb3duIGZpbGUgd2l0aDoKLSBMaXN0IGl0ZW0gMQotIExpc3QgaXRlbSAyCgpgYGBweXRob24KcHJpbnQoIkhlbGxvIFdvcmxkIikKYGBg';

      /**
       * Utility: Render a Bootstrap alert
       */
      function showAlert(type, message) {
        const container = document.getElementById('app-alert');
        if (!container) return;
        container.innerHTML = 
          '<div class="alert alert-' + type + ' alert-dismissible fade show" role="alert">' +
            message +
            '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>' +
          '</div>';
      }

      /**
       * Decode a base64 data URI to a UTF-8 string.
       * Assumes the format: data:*/*;base64,<base64>
       */
      function decodeDataURI(dataURI) {
        try {
          const prefix = 'base64,';
          const idx = dataURI.indexOf(prefix);
          if (idx === -1) throw new Error('Invalid data URI: missing base64 prefix');
          const b64 = dataURI.substring(idx + prefix.length);
          // atob handles ASCII; convert to UTF-8 safe string
          const binary = atob(b64);
          const bytes = Uint8Array.from(binary, c => c.charCodeAt(0));
          const decoded = new TextDecoder('utf-8').decode(bytes);
          return decoded;
        } catch (err) {
          console.error('decodeDataURI error:', err);
          throw err;
        }
      }

      /**
       * Render the markdown to HTML and apply syntax highlighting.
       */
      function renderMarkdown() {
        try {
          if (!window.marked) {
            throw new Error('marked.js did not load');
          }
          // Configure marked for modern behavior
          marked.setOptions({
            gfm: true,
            breaks: true,
            headerIds: true,
            mangle: false
          });

          const markdownText = decodeDataURI(INPUT_MD_DATA_URI);
          const rawHtml = marked.parse(markdownText);
          const safeHtml = (window.DOMPurify && typeof DOMPurify.sanitize === 'function')
            ? DOMPurify.sanitize(rawHtml)
            : rawHtml;

          const output = document.getElementById('markdown-output');
          if (!output) throw new Error('Missing #markdown-output element');

          output.innerHTML = safeHtml;

          // Apply syntax highlighting using highlight.js
          if (window.hljs && typeof hljs.highlightElement === 'function') {
            document.querySelectorAll('#markdown-output pre code').forEach(function (el) {
              try { hljs.highlightElement(el); } catch (e) { console.warn('Highlight error:', e); }
            });
          } else {
            console.warn('highlight.js not available');
          }

          // If rendering seems empty, show a gentle warning
          if (!output.innerHTML || !output.innerHTML.includes('<h')) {
            showAlert('warning', 'Rendering completed, but no headings were detected in the output.');
          }
        } catch (err) {
          showAlert('danger', 'Failed to render markdown: ' + (err && err.message ? err.message : 'Unknown error'));
        }
      }

      /**
       * Copy current HTML output to clipboard
       */
      async function copyHtmlToClipboard() {
        const output = document.getElementById('markdown-output');
        if (!output) return;
        try {
          const html = output.innerHTML || '';
          await navigator.clipboard.writeText(html);
          showAlert('success', 'Rendered HTML copied to clipboard.');
        } catch (err) {
          showAlert('danger', 'Unable to copy HTML: ' + (err && err.message ? err.message : 'Unknown error'));
        }
      }

      // Initialize after DOM ready
      document.addEventListener('DOMContentLoaded', function () {
        // Show the exact data URI we are using
        const dataEl = document.getElementById('data-uri-display');
        if (dataEl) {
          dataEl.textContent = INPUT_MD_DATA_URI;
        }

        // Render on load
        renderMarkdown();

        // Wire up buttons
        const renderBtn = document.getElementById('btn-render');
        if (renderBtn) renderBtn.addEventListener('click', renderMarkdown);
        const copyBtn = document.getElementById('btn-copy-html');
        if (copyBtn) copyBtn.addEventListener('click', copyHtmlToClipboard);
      });
    })();
  </script>
</body>
</html>